Changelog - 2026-01-31 (v0.62)
===============================

Branch: main

Session Start: ~2:27 PM

Actions Taken:
--------------
1. Restarted the local Python HTTP server on port 8000

2. Researched unp4k tooling for extracting Star Citizen game data:
   - unp4k (github.com/dolkensp/unp4k) extracts files from Data.p4k
   - unforge.exe converts CryXML and game.dcb (DataForge) to readable formats
   - Alternative tools: StarBreaker, scdatatools (Python), StarCitizen-GameData

3. Researched scunpacked data structure:
   - ships.json contains full ship specs + Loadout arrays
   - ship-items.json contains component/weapon index with display names
   - Loadout data includes: power plants, coolers, shields, quantum drives, weapons

4. Compared scunpacked data with app's stockLoadouts:
   - FINDING: ships.json ALREADY contains all stock loadout data with human-readable names!
   - The ~252 manually-entered stockLoadouts can be auto-extracted from ships.json
   - Example verified: Gladius has Regulus, Bracer, AllStop, Beacon, CF-337 Panther, Mantis GT-220

Key Finding:
------------
The manual work of entering stock loadouts is NOT needed going forward!
A script can parse ships.json and auto-generate stockLoadouts data.

Files Modified:
---------------
- changelog_2026-01-31.txt (created - this file)
- data.js - Replaced manual stockLoadouts with auto-extracted data (214 ships after filtering)
- app.js - Added variant ship support:
  - getShipSpec() now falls back to base ship for variants
  - findBaseShipName() helper to map variants to base ships
  - populateShipDropdown() includes variants from stockLoadouts

Files Created:
--------------
- scripts/extract-loadouts.js - Extraction script to parse ships.json
- scripts/extracted-loadouts.js - Generated output (260 ships, 208 with complete data)

Commits Made:
-------------
v0.61: Auto-extract ship specs and stock loadouts from ships.json

Notes for Next Steps:
---------------------
- Created v0.60 branch with extraction script
- Script extracts: powerPlants, coolers, shields, quantumDrives, pilotWeapons, turretWeapons
- Results: 260 ships extracted, 208 with complete component data, 52 partial (vehicles/snubs)
- Replaced stockLoadouts in data.js with auto-extracted data
- Only 4 conflicts found with existing data (trusted extracted data)
- TODO: Manually add snub fighter loadouts (P-52, P-72, Fury) later
- Syntax check passed, ready for browser testing

Continued Session - 2026-02-01:
-------------------------------
5. Created ship specs extraction script (scripts/extract-ships.js):
   - Extracts hardpoint configurations: pilot weapons, turrets, shields, power plants, coolers, QD
   - Properly distinguishes pilot weapons from manned/remote turrets
   - Uses MaxSize from hardpoints, with ClassName fallback for quantum drives
   - Filters out variants (uses base ship prefix detection)
   - Results: 176 base ships with hardpoint data

6. Fixed quantum drive size extraction:
   - Issue: Some QD hardpoints have MaxSize:0
   - Solution: Parse size from ClassName (e.g., "QDRV_JUST_S03_Kama" -> S3)

7. Replaced manual ships array in data.js with extracted data:
   - Created scripts/update-data.js helper script
   - 176 ships with complete hardpoint specs
   - Includes Grey's Shiv and other Teach's Ship Shop ships

8. Fixed turret detection in ship extraction:
   - Issue: Reclaimer showing 6 empty pilot weapons (should be 0)
   - Fix: Detect turrets by hardpoint name containing "turret"
   - Also detects remote turrets named "hardpoint_remote_turret_*"

9. Created validation script (scripts/validate-extraction.js):
   - Checks pilot weapon consistency (hardpoints vs stock loadouts)
   - Checks turret weapon consistency
   - Detects ships with no weapons (utility ships, ground vehicles)
   - Identifies variants without base ships
   - Run after extraction to catch issues

10. Fixed PDC turret detection in loadout extraction:
    - Issue: Reclaimer PDC weapons (M2C Swarm) categorized as pilot weapons
    - Fix: Detect PDCTurret type in categorizeWeapons function
    - Reduces validation issues from 79 to ~40

11. Created update-from-scunpacked.js script:
    - Downloads ships.json from GitHub (StarCitizenWiki/scunpacked-data)
    - Backs up existing ships.json
    - Runs all extraction scripts automatically
    - Runs validation and reports issues
    - Single command: node scripts/update-from-scunpacked.js

12. Updated background image to v1d:
    - Changed styles.css to use background_v1d_1920.jpg

Files Created (continued session):
----------------------------------
- scripts/extract-ships.js - Extracts ship hardpoint specs from ships.json
- scripts/extracted-ships.js - Generated output (176 ships with hardpoints)
- scripts/update-data.js - Helper to merge extracted data into data.js
- scripts/debug-ship.js - Debug helper for analyzing ship data
- scripts/validate-extraction.js - Validates extracted data for inconsistencies
- scripts/update-from-scunpacked.js - One-command update from scunpacked data

Commits Made (continued session):
---------------------------------
- v0.61: Auto-extract ship specs and stock loadouts from ships.json
- Add updated background image and Claude instructions
- Fix turret detection in ship extraction script
- Add validation script and fix turret detection in loadout extraction
- Add update script and new background image

Previous Session Context:
-------------------------
- API integration work is on feature/api-integration branch (not working well)
- Background image updated to v1d

Continued Session - 2026-02-01 (v0.62):
---------------------------------------
13. Added in-app "Check for Update" button:
    - Button added next to ABOUT link in header
    - Fetches processed-data.json from GitHub raw URL
    - Compares version timestamps to detect newer data
    - Shows modal with update info and confirmation button
    - Stores updated data in localStorage for persistence
    - Data persists across page refreshes

14. Implemented browser-side data update system:
    - loadCachedShipData() loads data from localStorage on startup
    - checkForUpdate() fetches and compares versions
    - applyUpdate() merges new data into SC_DATA and saves to localStorage
    - Version stored in localStorage as 'sc-component-tracker-data-version'

15. Modified update-from-scunpacked.js:
    - Now generates processed-data.json (221 KB) for browser updates
    - Contains ships array (167) and stockLoadouts (261)
    - Removed automatic data.js modification (was causing corruption)
    - data.js remains as bundled fallback data

16. Restored data.js from commit 4b4e6df:
    - Previous session corrupted data.js by incorrectly replacing structure
    - Restored proper structure: weapons, shields, powerPlants, coolers, quantumDrives, ships, stockLoadouts

17. Added CSS styles for update button:
    - .update-btn, .checking, .has-update states
    - Pulse animation for when update is available
    - Update modal styling

18. Updated version to 0.62

Files Modified:
---------------
- app.js - Added update check functionality, version to 0.62
- index.html - Added Check for Update button and update modal
- styles.css - Added update button and modal styles
- scripts/update-from-scunpacked.js - Generates processed-data.json, removed data.js update
- data.js - Restored from commit 4b4e6df (proper structure)

Files Created:
--------------
- processed-data.json - Pre-processed ship data for browser updates (221 KB)

Update Flow:
------------
1. User clicks "Check for Update" button
2. App fetches processed-data.json from GitHub
3. If newer version exists, shows modal with details
4. User clicks "Update Now" to apply
5. New data stored in localStorage and SC_DATA updated
6. UI refreshes with new ship data

Technical Notes:
----------------
- GitHub URL: https://raw.githubusercontent.com/Lucky44/SC-Component-Tracker/main/processed-data.json
- localStorage keys:
  - 'sc-ships-data' - Full ship data cache
  - 'sc-component-tracker-data-version' - Version timestamp
- processed-data.json structure: { version, lastUpdated, ships, stockLoadouts }
